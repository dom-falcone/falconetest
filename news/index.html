<!doctype html>
<html lang="ru">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Новости - Dom Falcone</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Titillium+Web:wght@300;400;600;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="../assets/css/style.css?v=3">
    <link rel="icon" href="../assets/images/Falcone-circle.png" type="image/png">
    <style>

.user-menu {
    display: flex;
    align-items: center;
    gap: 1.5rem;
}

.user-profile-info {
    display: flex;
    align-items: center;
    gap: 0.8rem;
    padding: 0.3rem 1rem 0.3rem 0.3rem;
    background: rgba(255, 23, 68, 0.1);
    border: 1px solid rgba(255, 23, 68, 0.3);
    border-radius: 30px;
    position: relative;
    text-decoration: none;
    transition: var(--transition);
    cursor: pointer;
}

.user-profile-info:hover {
    background: rgba(255, 23, 68, 0.2);
    border-color: rgba(255, 23, 68, 0.5);
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(255, 23, 68, 0.3);
}

.user-profile-info::before {
    content: '';
    position: absolute;
    left: 8px;
    bottom: 8px;
    width: 10px;
    height: 10px;
    background-color: #00e676;
    border-radius: 50%;
    border: 2px solid var(--color-bg);
    box-shadow: 0 0 10px #00e676, 0 0 20px rgba(0, 230, 118, 0.8);
    animation: pulse-online 2s infinite;
    z-index: 10;
}

@keyframes pulse-online {
    0%, 100% {
        opacity: 1;
        transform: scale(1);
    }
    50% {
        opacity: 0.7;
        transform: scale(1.1);
    }
}

.header-avatar {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    object-fit: cover;
    border: 2px solid var(--color-primary);
    position: relative;
}

.user-details {
    display: flex;
    flex-direction: column;
    gap: 0.2rem;
}

.user-display-name {
    color: white;
    font-weight: 600;
    font-size: 0.9rem;
    line-height: 1;
}

.user-points-badge {
    display: flex;
    align-items: center;
    gap: 0.3rem;
    font-size: 0.75rem;
    color: var(--color-primary);
}

</style>
</head>

<body>
    <!-- Page Loader -->
    <div id="page-loader">
        <div class="loader-content">
            <div class="loader-text">Ждать. Идет загрузка.</div>
            <div class="loader-hymn-section">
                <div class="loader-hymn-label">Гимн Дома Фальконе</div>
                <div class="loader-player-container">
                    <div class="loader-play-btn" id="loader-play-btn">
                        <div class="loader-play-icon"></div>
                    </div>
                    <div class="loader-progress-container">
                        <div class="loader-progress-bar" id="loader-progress"></div>
                    </div>
                </div>
                <audio id="loader-audio" src="../assets/audio/hymn.mp3"></audio>
            </div>
        </div>
    </div>
    <header class="topbar">
        <div class="container topbar-inner">
            <div class="brand">
                <a href="../homepage">
                    <div class="logo-mark"
                        style="background: url('../assets/images/Falcone.png') no-repeat center/cover;">
                    </div>
                    <span class="brand-title">Dom Falcone</span>
                </a>
            </div>
            <nav class="nav">
                <a href="../about">О доме</a>
                <a href="../history">История</a>
                <a href="../enemies">Противники</a>
                <a href="../news" class="active">Новости</a>
            </nav>
            <!-- Показываем кнопку по умолчанию -->
<div class="auth-action" id="auth-action">
    <a href="../login" class="btn-login">Войти</a>
</div>

<!-- Скрываем user menu по умолчанию -->
<div class="user-menu" id="user-menu" style="display: none;">
    <a href="../dashboard" class="user-profile-info">
        <img src="" alt="Avatar" id="header-avatar" class="header-avatar">
        <div class="user-details">
            <span class="user-display-name" id="header-display-name">User</span>
            <div class="user-points-badge">
                <span>⭐</span>
                <span id="header-points">0</span>
            </div>
        </div>
    </a>
</div>
        </div>
    </header>

    <div class="page-header"
        style="background: linear-gradient(rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.4)), url('../assets/images/news-background.jpg') center/cover no-repeat; background-position: center 55%;">
        <div class="container">
            <h1>Хроники Дома</h1>
            <p>Последние вести с полей сражений и жизни Семьи</p>
        </div>
    </div>

    <main class="content-section">
        <div class="container">

            <!-- Featured News -->
            <div class="featured-news animate-fade-up">
                <div class="featured-news-content">
                    <div class="news-tag">Важное</div>
                    <div class="news-date">21 Ноября 2025</div>
                    <h2>Расширение влияния: Рейд на Эдеку</h2>
                    <p>В прошлую пятницу состоялся стратегически важный визит в местную Эдеку. Представители Дома
                        Фальконе провели инспекцию пивного отдела и оценили запасы противника. Были выявлены новые
                        потенциальные угрозы в виде скидок на крепкий алкоголь.</p>
                    <p>Кандидаты на вступление проявили себя достойно, удерживая позиции в очереди на кассу. Операция
                        прошла успешно, ресурсы были захвачены без потерь.</p>
                    <a href="#" class="btn-text read-more-btn">Читать полностью &rarr;</a>

                    <!-- Full Content (Hidden) -->
                    <div class="news-full-content">
                        <p>В прошлую пятницу состоялся стратегически важный визит в местную Эдеку. Представители Дома
                            Фальконе провели инспекцию пивного отдела и оценили запасы противника. Были выявлены новые
                            потенциальные угрозы в виде скидок на крепкий алкоголь.</p>
                        <p>Кандидаты на вступление проявили себя достойно, удерживая позиции в очереди на кассу.
                            Операция прошла успешно, ресурсы были захвачены без потерь. Мы продолжаем расширять наше
                            влияние и укреплять позиции в регионе.</p>
                        <p>Особая благодарность выражается всем участникам рейда за проявленную дисциплину и выдержку.
                            Впереди нас ждут новые свершения и победы!</p>

                        <div class="news-modal-gallery">
                            <div class="gallery-item">
                                <img src="../assets/images/history12.jpg" alt="Собрание">
                            </div>
                            <div class="gallery-item">
                                <img src="../assets/images/history8.jpg" alt="Кальян">
                            </div>
                            <div class="gallery-item">
                                <img src="../assets/images/history7.jpg" alt="Победа">
                            </div>
                            <div class="gallery-item">
                                <img src="../assets/images/history1.jpg" alt="Архив">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- News Grid -->
            <div class="news-grid">
                <!-- News Item 1 -->
                <div class="news-card animate-fade-up">
                    <div class="news-card-content">
                        <div class="news-date">14 Ноября 2025</div>
                        <h3>Традиционный сбор: Дым и Пламя</h3>
                        <p>Очередное заседание прошло под эгидой густого дыма. Новый табак "Ледяной Арбуз" был успешно
                            протестирован и одобрен Доном. Атмосфера способствовала глубоким философским беседам о
                            будущем Семьи.</p>
                        <a href="#" class="btn-text read-more-btn">Подробнее</a>

                        <!-- Full Content (Hidden) -->
                        <div class="news-full-content">
                            <p>Очередное заседание прошло под эгидой густого дыма. Новый табак "Ледяной Арбуз" был
                                успешно протестирован и одобрен Доном. Атмосфера способствовала глубоким философским
                                беседам о будущем Семьи.</p>
                            <p>Обсуждались планы на ближайший месяц, а также стратегии по укреплению братства. Каждый
                                член Дома высказал свое мнение, и были приняты важные решения.</p>

                            <div class="news-modal-gallery">
                                <div class="gallery-item">
                                    <img src="../assets/images/history5.jpg" alt="Фото 5">
                                </div>
                                <div class="gallery-item">
                                    <img src="../assets/images/history4.jpg" alt="Фото 4">
                                </div>
                                <div class="gallery-item">
                                    <img src="../assets/images/history3.jpg" alt="Фото 3">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- News Item 2 -->
                <div class="news-card animate-fade-up">
                    <div class="news-card-content">
                        <div class="news-date">07 Ноября 2025</div>
                        <h3>Отчет о боевых действиях</h3>
                        <p>Битва с "ThreeSixty" завершилась безоговорочной победой Дома. Потери минимальны, моральный
                            дух на высоте. Противник был уничтожен полностью, трофеи (пустые бутылки) утилизированы
                            согласно протоколу.</p>
                        <a href="#" class="btn-text read-more-btn">Подробнее</a>

                        <!-- Full Content (Hidden) -->
                        <div class="news-full-content">
                            <p>Битва с "ThreeSixty" завершилась безоговорочной победой Дома. Потери минимальны,
                                моральный дух на высоте. Противник был уничтожен полностью, трофеи (пустые бутылки)
                                утилизированы согласно протоколу.</p>
                            <p>Это была славная битва, которая войдет в историю Дома Фальконе как пример мужества и
                                стойкости наших бойцов.</p>

                            <div class="news-modal-gallery">
                                <div class="gallery-item">
                                    <img src="../assets/images/history7.jpg" alt="Победа">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- News Item 3 -->
                <div class="news-card animate-fade-up">
                    <div class="news-card-content">
                        <div class="news-date">31 Октября 2025</div>
                        <h3>Вспоминая истоки</h3>
                        <p>В преддверии месяца основания, мы публикуем архивные записи первых дней формирования нашего
                            братства. Это напоминание о том, с чего все начиналось и какой путь мы прошли.</p>
                        <a href="#" class="btn-text read-more-btn">Подробнее</a>

                        <!-- Full Content (Hidden) -->
                        <div class="news-full-content">
                            <p>В преддверии месяца основания, мы публикуем архивные записи первых дней формирования
                                нашего братства. Это напоминание о том, с чего все начиналось и какой путь мы прошли.
                            </p>
                            <p>Мы помним каждого, кто стоял у истоков, и чтим традиции, заложенные в те дни. Una Fides,
                                Unus Dominus!</p>

                            <div class="news-modal-gallery">
                                <div class="gallery-item">
                                    <img src="../assets/images/history1.jpg" alt="Архив">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </main>

    <!-- News Modal -->
    <div id="news-modal">
        <div class="news-modal-content">
            <button class="news-modal-close">&times;</button>
            <div class="news-modal-scroll-container">
                <div class="news-modal-body">
                    <div class="news-modal-header">
                        <div class="news-modal-date"></div>
                        <h2 class="news-modal-title"></h2>
                    </div>
                    <div class="news-modal-text"></div>
                </div>
            </div>
        </div>
    </div>

    <footer class="site-footer">
        <div class="container">
            <small>© Дом Фальконе — 2025. Все права защищены. Прям реально защищены.</small>
            <div class="site-version"></div>
            <div class="footer-links">
                <a href="../privacy">Политика конфиденциальности</a>
                <a href="../agreement">Пользовательское соглашение</a>
                <a href="../imprint">Сведения о владельце сайта</a>
                <a href="../hymn">Герб и Гимн</a>
            </div>
        </div>
    </footer>

    <a href="../contact" class="floating-contact-btn">
        <img src="../assets/images/phone-icon.png" alt="Contact">
        <span class="btn-text">Связаться с Домом</span>
    </a>

    <script src="../assets/js/main.js?v=3"></script>

<script>
const API_BASE = "https://dom-falcone-auth.dom-falcone-official.workers.dev/api";
const token = localStorage.getItem('auth_token');

async function loadUserHeader() {
    if (!token) {
        // Если токена нет - показываем кнопку "Войти"
        document.getElementById('auth-action').style.display = 'block';
        document.getElementById('user-menu').style.display = 'none';
        return;
    }
    
    try {
        const res = await fetch(API_BASE + "/me", {
            headers: { "Authorization": "Bearer " + token }
        });

        if (res.ok) {
            const userData = await res.json();
            
            // Скрываем кнопку "Войти" и показываем user menu
            document.getElementById('auth-action').style.display = 'none';
            document.getElementById('user-menu').style.display = 'flex';
            
            // Заполняем данные
            document.getElementById('header-display-name').textContent = 
                userData.display_name || userData.email.split('@')[0];
            document.getElementById('header-points').textContent = userData.points || 0;
            
            // Аватарка
            const avatar = document.getElementById('header-avatar');
            if (userData.avatar_url) {
                avatar.src = userData.avatar_url;
            } else {
                // SVG placeholder с первой буквой имени
                const initial = userData.display_name ? userData.display_name[0].toUpperCase() : 'U';
                avatar.src = "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='40' height='40'%3E%3Crect fill='%23ff1744' width='40' height='40'/%3E%3Ctext x='50%25' y='50%25' dominant-baseline='middle' text-anchor='middle' fill='white' font-size='20' font-family='Arial'%3E" + initial + "%3C/text%3E%3C/svg%3E";
            } // ← ВОТ ЭТА СКОБКА БЫЛА ПРОПУЩЕНА!
        } else {
            // Если токен невалиден - удаляем его и показываем кнопку "Войти"
            localStorage.removeItem('auth_token');
            document.getElementById('auth-action').style.display = 'block';
            document.getElementById('user-menu').style.display = 'none';
        }
    } catch (err) {
        console.error('Error loading user header:', err);
        // При ошибке показываем кнопку "Войти"
        document.getElementById('auth-action').style.display = 'block';
        document.getElementById('user-menu').style.display = 'none';
    }
}

// Запускаем при загрузке страницы
document.addEventListener('DOMContentLoaded', loadUserHeader);
</script>
</body>

</html>
